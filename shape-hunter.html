<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ–å½¢å¤§æœæŸ¥ Shape Hunter</title>
    <style>
        /* CSS ç¹ªè£½é›²æœµ */
        .cloud {
            position: absolute;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
            z-index: 0;
            opacity: 0.8;
            animation: moveClouds 20s linear infinite; /* é›²æœµç§»å‹•å‹•ç•« */
        }
        .cloud1 { top: 5%; left: 10%; width: 80px; height: 50px; }
        .cloud2 { top: 10%; right: 15%; width: 120px; height: 70px; animation-delay: -10s; } /* éŒ¯é–‹å‹•ç•«æ™‚é–“ */
        .cloud1::before { content: ''; position: absolute; top: -10px; left: 10px; width: 50px; height: 50px; border-radius: 50%; background: inherit; }
        .cloud2::before { content: ''; position: absolute; top: 5px; right: 15px; width: 70px; height: 70px; border-radius: 50%; background: inherit; }

        @keyframes moveClouds {
            0% { transform: translateX(-10%); } /* å¾è¦–çª—å·¦é‚Šé–‹å§‹ */
            100% { transform: translateX(100vw); } /* ç§»å‹•åˆ°è¦–çª—å³é‚Šä¹‹å¤– */
        }

        body {
            font-family: 'Comic Sans MS', 'Microsoft JhengHei', sans-serif;
            /* èƒŒæ™¯æ¼¸è®Šï¼šè—å¤© -> ç¶ åœ° */
            background: linear-gradient(to bottom, #87ceeb 0%, #87ceeb 40%, #c9e265 85%, #7aa84e 100%); 
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 0; 
            position: relative; 
            overflow: hidden; 
        }

        h1 {
            color: #333;
            margin-top: 20px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0px white, -2px -2px 0px white; 
            z-index: 10;
        }
        
        /* è¾²å¤«èˆ‡å•é¡Œå€å¡Šå®¹å™¨ - ä½¿ç”¨ Flexbox ç¢ºä¿å‚ç›´å°é½Š */
        .top-info-container {
            display: flex;
            justify-content: center;
            align-items: flex-end; /* åº•éƒ¨å°é½Š */
            width: 90%;
            max-width: 800px;
            margin-bottom: 20px;
            z-index: 10;
        }

        /* è¾²å¤«å€å¡Š */
        .farmer-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            width: 150px; 
            flex-shrink: 0; 
        }

        /* è¾²å¤« Emoji å°ºå¯¸ */
        .farmer-emoji {
            font-size: 8rem; 
            margin-bottom: 0px; 
            transition: transform 0.2s;
            line-height: 1; 
        }

        /* å°è©±æ¡† */
        .speech-bubble {
            background-color: white;
            border-radius: 20px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            position: relative;
            font-size: 1.1rem;
            text-align: center;
            min-height: 80px; 
            display: flex;
            flex-direction: column;
            justify-content: center;
            margin-right: 10px; 
            color: #333;
            border: 3px solid #f39c12; 
            flex-grow: 1; /* ä½”æ“šå‰©é¤˜ç©ºé–“ */
        }

        /* å°è©±æ¡†çš„å°–è§’ (æŒ‡å‘è¾²å¤«) */
        .speech-bubble::after {
            content: '';
            position: absolute;
            right: -20px; 
            bottom: 25px; 
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-top: 15px solid transparent;
            border-bottom: 15px solid transparent;
            border-left: 20px solid #f39c12; 
        }
        .speech-bubble::before { 
            content: '';
            position: absolute;
            right: -15px;
            bottom: 25px;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-top: 12px solid transparent;
            border-bottom: 12px solid transparent;
            border-left: 15px solid white;
            z-index: 1;
        }

        .target-display {
            font-size: 1.5rem;
            font-weight: bold;
            color: #d35400;
        }

        /* åˆ†æ•¸å’Œç­‰ç´šé¢æ¿ */
        .info-panel {
            background: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            width: 90%;
            max-width: 800px;
            font-size: 1.2rem;
            border: 2px dashed #9b59b6;
            z-index: 10;
        }
        
        /* éŠæˆ²ç¶²æ ¼å®¹å™¨ */
        .game-grid {
            display: grid;
            justify-content: center;
            gap: 20px; /* å¢åŠ é–“è· */
            margin-bottom: 20px;
            background-color: rgba(255, 255, 255, 0.8); 
            padding: 0px; 
            border-radius: 20px;
            box-shadow: 0 8px 15px rgba(0,0,0,0.2);
            z-index: 10;
        }

        /* éŠæˆ²é–‹å§‹å¾Œï¼Œå‹•æ…‹æ·»åŠ  padding å’Œ grid ä½ˆå±€ */
        .game-grid.active {
            padding: 20px;
            background-color: transparent; /* éŠæˆ²é–‹å§‹å¾Œï¼Œéš±è—èƒŒæ™¯è‰²ï¼Œè®“æ´ç©´æ›´è‡ªç„¶ */
            box-shadow: none;
        }


        /* åœ°é¼ æ´ */
        .hole {
            width: 120px;
            height: 120px;
            background-color: #8d6e63; /* æ´å£é¡è‰² */
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            border-bottom: 8px solid #5d4037; /* æ´çš„åº•éƒ¨é™°å½± */
            box-shadow: inset 0 10px 20px rgba(0,0,0,0.3);
            cursor: pointer; 
            display: flex;
            justify-content: center;
            align-items: flex-end;
            -webkit-tap-highlight-color: transparent; 
        }

        /* æ§Œå­å‹•ç•«æ•ˆæœ */
        .hammer-hit {
            position: fixed; /* ä½¿ç”¨ fixed ç¢ºä¿å®ƒåœ¨è¦–çª—ä¸­å¤® */
            font-size: 15rem; 
            transform: translate(-50%, -50%) rotate(45deg) scale(0); 
            animation: hammerPulse 0.3s ease-out forwards; 
            pointer-events: none; 
            z-index: 1000;
        }
        @keyframes hammerPulse {
            0% { transform: translate(-50%, -50%) rotate(45deg) scale(0); opacity: 0; }
            50% { transform: translate(-50%, -50%) rotate(0deg) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -50%) rotate(-45deg) scale(0.8); opacity: 0; }
        }
        
        /* ç­”éŒ¯æ™‚ï¼Œæ­£ç¢ºåœ–å½¢æœƒé–ƒçˆ */
        .hole.highlight {
            animation: highlight-blink 0.8s infinite alternate; 
            border: 5px solid gold !important; 
            box-shadow: 0 0 20px gold !important; 
        }
        @keyframes highlight-blink {
            from { opacity: 1; }
            to { opacity: 0.5; }
        }

        .shape {
            width: 90px;
            height: 90px;
            position: absolute;
            bottom: -100px; /* è—åœ¨åœ°æ´è£¡ */
            transition: bottom 0.2s;
        }

        .shape.up {
            bottom: 10px; /* å½ˆå‡ºä¾† */
        }

        button {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.5rem;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 0 #27ae60;
            transition: transform 0.1s;
            margin-top: 10px;
            z-index: 10;
        }

        button:active {
            transform: translateY(4px);
            box-shadow: 0 1px 0 #27ae60;
        }

        #level-indicator { color: #2980b9; font-weight: bold; }
        #score-board { color: #e74c3c; font-weight: bold; font-size: 1.5rem; }

        /* èª‡å¼µçš„ç­”å°å›é¥‹æ¨£å¼ */
        .feedback {
            position: fixed;
            top: 50%; 
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 6rem;
            color: yellow;
            text-shadow: 4px 4px 8px #f39c12;
            opacity: 0;
            pointer-events: none;
            z-index: 999;
        }
        
        .svg-shape { width: 80px; height: 80px; }

        /* é©æ‡‰å°è¢å¹• */
        @media (max-width: 768px) {
            .top-info-container {
                flex-direction: column;
                align-items: center;
            }
            .speech-bubble {
                margin-right: 0;
                margin-bottom: 30px; /* å¢åŠ é–“è·é¿å…é‡ç–Š */
            }
            /* èª¿æ•´å°è©±æ¡†å°–è§’ä½ç½® */
            .speech-bubble::after, .speech-bubble::before {
                right: initial;
                bottom: -20px;
                left: 50%;
                transform: translateX(-50%);
                border-top: 20px solid #f39c12;
                border-left: 15px solid transparent;
                border-right: 15px solid transparent;
                border-bottom: none;
            }
            .speech-bubble::before {
                border-top: 15px solid white;
            }
            .farmer-section {
                order: -1; 
                margin-top: 10px;
            }
            .farmer-emoji {
                font-size: 6rem; 
            }
            .hammer-hit {
                font-size: 8rem; 
            }
            .hole {
                width: 100px;
                height: 100px;
            }
            .svg-shape { 
                width: 70px; 
                height: 70px; 
            }
        }
    </style>
</head>
<body>
    <div class="cloud cloud1"></div>
    <div class="cloud cloud2"></div>

    <h1>åœ–å½¢å¤§æœæŸ¥ <br><span style="font-size:0.6em">Shape Hunter</span></h1>

    <audio id="background-music" loop>
        <source src="Funny Cartoon Kids Background Music For Videos.mp3" type="audio/mpeg">
        æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´ audio å…ƒç´ ã€‚
    </audio>

    <div class="top-info-container">
        <div class="speech-bubble" id="instruction-bubble">
            <div class="target-display" id="instruction">
                è«‹é–‹å•Ÿå–‡å­ ğŸ”Š<br>
                Please turn on volume
            </div>
        </div>
        
        <div class="farmer-section">
            <div class="farmer-emoji" role="img" aria-label="è¾²å¤«">ğŸ‘¨â€ğŸŒ¾</div> 
        </div>
    </div>
    
    <div class="info-panel">
        <div>Level: <span id="level-indicator">1</span></div>
        <div>Score åˆ†æ•¸: <span id="score-board">0</span></div>
    </div>

    <div class="game-grid" id="grid">
    </div>

    <button id="start-btn" onclick="startGame()">é–‹å§‹éŠæˆ² / Start</button>

    <div class="feedback" id="feedback"></div>

    <script>
        // --- 1. éŸ³æ•ˆç³»çµ± (å®å’šè²) ---
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx;

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new AudioContext();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        function playDingDong() {
            if (!audioCtx) return;
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(1046.50, audioCtx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(1318.51, audioCtx.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.5, audioCtx.currentTime + 0.05);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.6);
        }

        // --- 2. èªéŸ³æœ—è®€ç³»çµ± (Text-to-Speech) ---
        function speakText(textEN, rateEN, textTW, rateTW) {
            if (!window.speechSynthesis) return;
            window.speechSynthesis.cancel();

            const utterEN = new SpeechSynthesisUtterance(textEN);
            utterEN.lang = 'en-US'; 
            utterEN.rate = rateEN;

            const utterTW = new SpeechSynthesisUtterance(textTW);
            utterTW.lang = 'zh-HK'; 
            utterTW.rate = rateTW;

            window.speechSynthesis.speak(utterEN);
            window.speechSynthesis.speak(utterTW);
        }
        
        // --- 3. èƒŒæ™¯éŸ³æ¨‚æ§åˆ¶ (ä½¿ç”¨ MP3 Audio æ¨™ç±¤) ---
        const backgroundMusic = document.getElementById('background-music');
        
        function playBackgroundMusic() {
            // *** éŸ³é‡è¨­å®šç‚º 10% (0.1) ***
            backgroundMusic.volume = 0.1; 
            backgroundMusic.play().catch(error => {
                console.log("Background music autoplay failed:", error);
            });
        }
        
        // --- 4. éŠæˆ²é‚è¼¯ ---
        let score = 0;
        let currentLevel = 1;
        let isPlaying = false;
        let currentTargetShape = ""; 
        let holesCount = 2; 
        let correctHoleElement = null; 

        const shapes = [
            { id: 'circle', nameTW: 'åœ“å½¢', nameEN: 'Circle', color: '#e74c3c', svg: `<svg viewBox="0 0 100 100" class="svg-shape"><circle cx="50" cy="50" r="45" fill="#e74c3c" stroke="black" stroke-width="2"/></svg>` },
            { id: 'square', nameTW: 'æ­£æ–¹å½¢', nameEN: 'Square', color: '#3498db', svg: `<svg viewBox="0 0 100 100" class="svg-shape"><rect x="10" y="10" width="80" height="80" fill="#3498db" stroke="black" stroke-width="2"/></svg>` },
            { id: 'triangle', nameTW: 'ä¸‰è§’å½¢', nameEN: 'Triangle', color: '#2ecc71', svg: `<svg viewBox="0 0 100 100" class="svg-shape"><polygon points="50,5 95,95 5,95" fill="#2ecc71" stroke="black" stroke-width="2"/></svg>` }
        ];

        const grid = document.getElementById('grid');
        const instruction = document.getElementById('instruction');
        const scoreBoard = document.getElementById('score-board');
        const levelDisplay = document.getElementById('level-indicator');
        const startBtn = document.getElementById('start-btn');
        const feedback = document.getElementById('feedback');
        const instructionBubble = document.getElementById('instruction-bubble');

        function initBoard(numHoles) {
            grid.innerHTML = '';
            grid.classList.add('active'); // é–‹å§‹éŠæˆ²æ™‚ï¼Œæ·»åŠ  active é¡ä»¥è¨­ç½® grid ä½ˆå±€
            
            // è®“ grid æ ¹æ“šæ´çš„æ•¸é‡è‡ªå‹•èª¿æ•´ä½ˆå±€
            let columns = numHoles;
            if (numHoles === 4) {
                // 4å€‹æ´æ’æˆ 2x2 
                grid.style.gridTemplateColumns = `repeat(2, 1fr)`;
                grid.style.maxWidth = '300px'; 
            } else if (numHoles === 3) {
                // 3å€‹æ´æ’æˆ 3å€‹
                grid.style.gridTemplateColumns = `repeat(3, 1fr)`;
                grid.style.maxWidth = '450px'; 
            } else { // 2å€‹æ´
                grid.style.gridTemplateColumns = `repeat(2, 1fr)`;
                grid.style.maxWidth = '300px'; 
            }
            
            for (let i = 0; i < numHoles; i++) {
                let hole = document.createElement('div');
                hole.classList.add('hole');
                
                let shapeDiv = document.createElement('div');
                shapeDiv.classList.add('shape');
                shapeDiv.id = `mole-${i}`; 
                
                // é»æ“Šäº‹ä»¶ç¶å®šåœ¨åœ°æ´ä¸Š
                hole.onclick = (e) => {
                    // é»æ“Šæ™‚é¡¯ç¤ºæ§Œå­å‹•ç•«
                    showHammerAnimation(e.clientX, e.clientY);
                    checkHit(shapeDiv);
                };
                
                hole.appendChild(shapeDiv);
                grid.appendChild(hole);
            }
        }

        // é¡¯ç¤ºæ§Œå­å‹•ç•«å‡½å¼
        function showHammerAnimation(x, y) {
            const hammer = document.createElement('div');
            hammer.classList.add('hammer-hit');
            hammer.innerText = 'ğŸ”¨'; /* æ§Œå­ Emoji */
            
            // æ ¹æ“šé»æ“Šä½ç½®è¨­ç½®æ§Œå­ä½ç½®
            hammer.style.left = `${x}px`;
            hammer.style.top = `${y}px`;
            
            document.body.appendChild(hammer);

            // å‹•ç•«çµæŸå¾Œç§»é™¤æ§Œå­å…ƒç´ 
            hammer.addEventListener('animationend', () => {
                hammer.remove();
            });
        }


        function startGame() {
            initAudio(); 
            playBackgroundMusic(); // é»æ“Šé–‹å§‹å¾Œæ’­æ”¾èƒŒæ™¯éŸ³æ¨‚ (MP3)
            score = 0;
            currentLevel = 1;
            scoreBoard.innerText = score;
            startBtn.style.display = 'none';
            isPlaying = true;
            updateLevelSettings();
            nextRound();
        }

        function updateLevelSettings() {
            if (currentLevel === 1) {
                holesCount = 2;
            } else if (currentLevel === 2) {
                holesCount = 3;
            } else {
                holesCount = 4;
            }
            levelDisplay.innerText = `${currentLevel}`;
            initBoard(holesCount);
        }

        function nextRound() {
            if (!isPlaying) return;

            if (correctHoleElement) {
                correctHoleElement.parentElement.classList.remove('highlight');
            }

            const targetIndex = Math.floor(Math.random() * shapes.length);
            const targetObj = shapes[targetIndex];
            currentTargetShape = targetObj.id;

            instruction.innerHTML = `
                æ‰¾æ‰¾çœ‹: <span style="color:${targetObj.color}">${targetObj.nameTW}</span> <br> 
                Find: <span style="color:${targetObj.color}">${targetObj.nameEN}</span>
            `;

            speakText(targetObj.nameEN, 0.8, targetObj.nameTW, 0.8);

            const holes = document.querySelectorAll('.shape');
            holes.forEach(h => {
                h.classList.remove('up');
                h.innerHTML = '';
                h.dataset.id = '';
            });

            const correctHoleIndex = Math.floor(Math.random() * holesCount);
            correctHoleElement = holes[correctHoleIndex]; 
            correctHoleElement.innerHTML = targetObj.svg;
            correctHoleElement.dataset.id = targetObj.id;

            for (let i = 0; i < holesCount; i++) {
                if (holes[i] !== correctHoleElement) { 
                    let distractorObj;
                    do {
                        distractorObj = shapes[Math.floor(Math.random() * shapes.length)];
                    } while (distractorObj.id === targetObj.id);
                    holes[i].innerHTML = distractorObj.svg;
                    holes[i].dataset.id = distractorObj.id;
                }
            }

            setTimeout(() => {
                holes.forEach(h => h.classList.add('up'));
            }, 1000); 
        }

        function checkHit(element) {
            // ç¢ºä¿é»æ“Šçš„åœ–å½¢å·²ç¶“å½ˆå‡º
            if (!element.classList.contains('up')) return;

            // ç­”é¡Œå¾Œå–æ¶ˆé–ƒçˆ
            if (correctHoleElement && correctHoleElement.parentElement.classList.contains('highlight')) {
                 correctHoleElement.parentElement.classList.remove('highlight');
            }

            if (element.dataset.id === currentTargetShape) {
                // ç­”å°é‚è¼¯
                speakText("Fantastic!", 1.5, "å¥½å˜¢ï¼ä½ ç­”å•±å•¦ï¼åšå¾—å¤ªå¥½å•¦ï¼", 1.5);
                playDingDong(); 

                score += 10;
                scoreBoard.innerText = score;
                element.classList.remove('up');
                showFeedback(true, "ğŸ’¥ å‹å‘€ï¼");
                
                checkLevelUp();
                setTimeout(nextRound, 2000); 
            } else {
                // ç­”éŒ¯é‚è¼¯
                speakText("Try again", 0.9, "ç­”éŒ¯å•¦ï¼Œå†è©¦å“å•¦", 0.9);
                
                // è¦–è¦ºæç¤ºï¼šæ­£ç¢ºçš„æ´é–‹å§‹é–ƒçˆ
                if (correctHoleElement && correctHoleElement.parentElement) {
                    correctHoleElement.parentElement.classList.add('highlight');
                }
                
                // ç­”éŒ¯åœ–å½¢æ–æ™ƒ
                element.style.transform = "translateX(5px)";
                setTimeout(() => element.style.transform = "translateX(0)", 100);
            }
        }

        function showFeedback(isSuccess, text = "â­• Great!") {
            if(isSuccess) {
                feedback.innerText = text; 
                feedback.style.opacity = 1;
                feedback.style.transition = 'opacity 0s';
                setTimeout(() => {
                    feedback.style.opacity = 0;
                    feedback.style.transition = 'opacity 1s';
                }, 800);
            }
        }

        function checkLevelUp() {
            if (score >= 50 && currentLevel === 1) {
                currentLevel = 2;
                speakText("Good Job", 1.0, "å¥½çŠ€åˆ©ï¼", 1.0);
                alert("å¥½çŠ€åˆ©ï¼å‡ç´šäº†ï¼\nLevel Up! Next Level: 3 Holes");
                updateLevelSettings();
            } else if (score >= 150 && currentLevel === 2) {
                currentLevel = 3;
                speakText("Wonderful", 1.0, "å¤ªå¼·å•¦ï¼", 1.0);
                alert("å¤ªå¼·å•¦ï¼æœ€é«˜ç´šï¼\nWow! Level 3!");
                updateLevelSettings();
            }
        }
    </script>
</body>
</html>